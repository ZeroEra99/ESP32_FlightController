<?xml version="1.0" encoding="UTF-8"?>
<UML>
  <Class name="Actuator">
    <Attributes>
      <Attribute type="int" name="pin" />
      <Attribute type="int" name="pwm_min" />
      <Attribute type="int" name="pwm_max" />
      <Attribute type="int" name="pwm_null" />
      <Attribute type="double" name="digital_min" />
      <Attribute type="double" name="digital_max" />
    </Attributes>
    <Methods>
      <Method name="Actuator">
        <Parameter type="int" name="pin" />
        <Parameter type="int" name="pwm_min" />
        <Parameter type="int" name="pwm_max" />
        <Parameter type="int" name="pwm_null" />
        <Parameter type="double" name="digital_min" />
        <Parameter type="double" name="digital_max" />
      </Method>
      <Method name="write">
        <Parameter type="double" name="value" />
      </Method>
    </Methods>
  </Class>

  <Class name="Receiver">
    <Attributes>
      <Attribute type="int" name="rxPin" />
      <Attribute type="ReceiverData" name="receiver_data" />
      <Attribute type="bool" name="RECEIVER_ERROR" />
    </Attributes>
    <Methods>
      <Method name="Receiver">
        <Parameter type="int" name="rxPin" />
      </Method>
      <Method name="read">
        <Parameter type="ReceiverData&" name="data" />
      </Method>
      <Method name="logData">
        <Parameter type="const ReceiverData&" name="data" />
      </Method>
      <Method name="resetBuffer" />
      <Method name="decodeIBusPacket" />
    </Methods>
  </Class>

  <Class name="IMU">
    <Attributes>
      <Attribute type="ImuData" name="imu_data" />
      <Attribute type="bool" name="IMU_ERROR" />
    </Attributes>
    <Methods>
      <Method name="read">
        <Parameter type="ImuData&" name="data" />
      </Method>
      <Method name="logData">
        <Parameter type="const ImuData&" name="data" />
      </Method>
    </Methods>
  </Class>

  <Class name="LED">
    <Attributes>
      <Attribute type="int" name="pin" />
      <Attribute type="LED_STATE" name="state" />
    </Attributes>
    <Methods>
      <Method name="LED">
        <Parameter type="int" name="pin" />
      </Method>
      <Method name="set_state">
        <Parameter type="LED_STATE" name="state" />
      </Method>
      <Method name="update" />
    </Methods>
  </Class>

  <Class name="RGB_LED">
    <Attributes>
      <Attribute type="int" name="pin_red" />
      <Attribute type="int" name="pin_green" />
      <Attribute type="int" name="pin_blue" />
      <Attribute type="COLOR" name="color" />
      <Attribute type="LED_STATE" name="state" />
    </Attributes>
    <Methods>
      <Method name="RGB_LED">
        <Parameter type="int" name="pin_red" />
        <Parameter type="int" name="pin_green" />
        <Parameter type="int" name="pin_blue" />
      </Method>
      <Method name="set_state">
        <Parameter type="LED_STATE" name="state" />
        <Parameter type="COLOR" name="color" />
      </Method>
      <Method name="update" />
    </Methods>
  </Class>

  <Class name="Aircraft">
    <Attributes>
      <Attribute type="Receiver" name="receiver" />
      <Attribute type="RGB_LED" name="led_rgb" />
      <Attribute type="IMU" name="imu" />
      <Attribute type="ImuData" name="imu_data" />
      <Attribute type="ReceiverData" name="receiver_data" />
      <Attribute type="Output" name="output" />
      <Attribute type="Errors" name="error" />
    </Attributes>
    <Methods>
      <Method name="Aircraft" />
      <Method name="read_imu">
        <Parameter type="Errors&" name="error" />
      </Method>
      <Method name="read_receiver">
        <Parameter type="Errors&" name="error" />
      </Method>
      <Method name="update_leds">
        <Parameter type="ASSIST_MODE" name="assist_mode" />
        <Parameter type="CONTROLLER_STATE" name="state" />
      </Method>
      <Method name="write_actuators" />
    </Methods>
  </Class>

  <Class name="PIDController">
    <Attributes>
      <Attribute type="double" name="kp" />
      <Attribute type="double" name="ki" />
      <Attribute type="double" name="kd" />
      <Attribute type="double" name="maxIntegral" />
      <Attribute type="double" name="integral" />
      <Attribute type="double" name="lastError" />
    </Attributes>
    <Methods>
      <Method name="compute">
        <Parameter type="double" name="error" />
        <Parameter type="double" name="dt" />
        <Parameter type="double" name="kp_offset" />
        <Parameter type="double" name="ki_offset" />
        <Parameter type="double" name="kd_offset" />
      </Method>
    </Methods>
  </Class>

  <Class name="FlightController">
    <Attributes>
      <Attribute type="Aircraft" name="aircraft" />
      <Attribute type="CONTROLLER_STATE" name="state" />
      <Attribute type="ASSIST_MODE" name="assist_mode" />
      <Attribute type="CONTROLLER_MODE" name="controller_mode" />
      <Attribute type="CALIBRATION_TARGET" name="calibration_target" />
      <Attribute type="Errors" name="error" />
    </Attributes>
    <Methods>
      <Method name="FlightController">
        <Parameter type="Aircraft&" name="aircraft" />
      </Method>
      <Method name="compute_data">
        <Parameter type="double" name="dt" />
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="ImuData&" name="imu_data" />
        <Parameter type="Output&" name="output" />
      </Method>
      <Method name="control">
        <Parameter type="double" name="dt" />
        <Parameter type="ImuData&" name="imu_data" />
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="Output&" name="output" />
      </Method>
      <Method name="check_errors" />
      <Method name="update_state">
        <Parameter type="ReceiverData&" name="receiver_data" />
      </Method>
      <Method name="update_modes">
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="bool" name="imuSetupComplete" />
      </Method>
      <Method name="set_output">
        <Parameter type="Output&" name="output" />
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="bool" name="imuSetupComplete" />
      </Method>
    </Methods>
  </Class>

  <Class name="SystemController">
    <Attributes>
      <Attribute type="CONTROLLER_STATE" name="state" />
      <Attribute type="CONTROLLER_MODE" name="mode" />
      <Attribute type="ASSIST_MODE" name="assist_mode" />
      <Attribute type="CALIBRATION_TARGET" name="calibration_target" />
      <Attribute type="Errors" name="error" />
      <Attribute type="bool" name="isFailsafeActive" />
    </Attributes>
    <Methods>
      <Method name="SystemController" />
      <Method name="update_state">
        <Parameter type="CONTROLLER_STATE" name="newState" />
      </Method>
      <Method name="check_errors" />
      <Method name="resetFailsafe" />
      <Method name="update_modes">
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="bool" name="imuSetupComplete" />
      </Method>
      <Method name="set_output">
        <Parameter type="Output&" name="output" />
        <Parameter type="ReceiverData&" name="receiver_data" />
        <Parameter type="bool" name="imuSetupComplete" />
      </Method>
      <Method name="failSafe" />
      <Method name="check_disarm_conditions">
        <Parameter type="ReceiverData&" name="receiver_data" />
      </Method>
      <Method name="check_arm_conditions">
        <Parameter type="ReceiverData&" name="receiver_data" />
      </Method>
    </Methods>
  </Class>

  <Class name="WiFiManager">
    <Attributes>
      <Attribute type="String" name="ssid" />
      <Attribute type="String" name="password" />
      <Attribute type="bool" name="isConnected" />
      <Attribute type="String" name="discoveredServer" />
    </Attributes>
    <Methods>
      <Method name="begin">
        <Parameter type="const char*" name="ssid" />
        <Parameter type="const char*" name="password" />
      </Method>
      <Method name="discoverServer">
        <Parameter type="const char*" name="serverName" />
      </Method>
      <Method name="isServerActive" />
      <Method name="WiFiConnectionTask">
        <Parameter type="void*" name="param" />
      </Method>
      <Method name="serverDiscoveryTask">
        <Parameter type="void*" name="param" />
      </Method>
      <Method name="serverCheckTask">
        <Parameter type="void*" name="param" />
      </Method>
    </Methods>
  </Class>

  <Class name="Logger">
    <Attributes>
      <Attribute type="String" name="logBuffer" />
      <Attribute type="String" name="dataBuffer" />
    </Attributes>
    <Methods>
      <Method name="log">
        <Parameter type="const std::string&" name="message" />
      </Method>
      <Method name="sendLogToServer">
        <Parameter type="const std::string&" name="log" />
      </Method>
      <Method name="prepareDataBuffer" />
      <Method name="sendDataToServer" />
    </Methods>
  </Class>
</UML>
